<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de pricing | Automatizaciones</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #080c1a;
      --panel: #0f172a;
      --muted: #9fb1d0;
      --text: #e8ecf5;
      --accent: #7c3aed;
      --accent-2: #22d3ee;
      --border: rgba(255, 255, 255, 0.08);
      --success: #34d399;
      --danger: #f87171;
      --shadow: 0 20px 80px rgba(0, 0, 0, 0.45);
      --radius: 16px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Manrope', system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(124, 58, 237, 0.12), transparent 30%),
                  radial-gradient(circle at 80% 0%, rgba(34, 211, 238, 0.12), transparent 25%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 32px;
    }

    h1, h2, h3, .metric-value {
      font-family: 'Space Grotesk', 'Manrope', system-ui, sans-serif;
      letter-spacing: -0.01em;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 12px;
      color: var(--muted);
    }

    .brand h1 {
      margin: 0;
      font-size: 28px;
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      border: 1px solid var(--border);
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.9), rgba(34, 211, 238, 0.9));
      color: #0b0f1c;
      padding: 12px 16px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.12s ease, opacity 0.12s ease;
      box-shadow: var(--shadow);
    }

    button.secondary {
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      box-shadow: none;
    }

    button:hover {
      transform: translateY(-1px);
      opacity: 0.95;
    }

    .layout {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 16px;
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
    }

    .card h3 {
      margin: 0 0 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 16px;
    }

    .grid {
      display: grid;
      gap: 12px;
    }

    .grid.two {
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }

    label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 13px;
      color: var(--muted);
    }

    input[type="number"], textarea {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.02);
      color: var(--text);
      font-size: 15px;
    }

    input[type="number"]:focus, textarea:focus {
      outline: 1px solid var(--accent-2);
      border-color: rgba(34, 211, 238, 0.5);
    }

    textarea {
      min-height: 110px;
      resize: vertical;
    }

    .scenario-chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .chip {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .chip.active {
      border-color: rgba(124, 58, 237, 0.6);
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.24), rgba(34, 211, 238, 0.18));
    }

    .results-hero {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-bottom: 12px;
    }

    .metric-card {
      padding: 14px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.02);
    }

    .metric-label {
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 6px;
    }

    .metric-value {
      font-size: 28px;
      font-weight: 700;
    }

    .metric-sub {
      margin-top: 4px;
      font-size: 13px;
      color: var(--muted);
    }

    .mini-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .scenario-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .scenario-card {
      padding: 14px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.03);
    }

    .scenario-card h4 {
      margin: 0 0 6px;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(124, 58, 237, 0.12);
      color: var(--text);
      font-size: 12px;
      border: 1px solid var(--border);
    }

    .summary-box {
      margin-top: 12px;
      padding: 14px;
      border-radius: var(--radius);
      background: rgba(255, 255, 255, 0.02);
      border: 1px dashed var(--border);
      font-size: 14px;
      color: var(--text);
      white-space: pre-line;
    }

    .inline-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(52, 211, 153, 0.1);
      color: var(--success);
      border: 1px solid rgba(52, 211, 153, 0.3);
      font-size: 12px;
      font-weight: 700;
    }

    .tag.danger {
      background: rgba(248, 113, 113, 0.12);
      color: var(--danger);
      border-color: rgba(248, 113, 113, 0.3);
    }

    @media (max-width: 960px) {
      body { padding: 20px; }
      .layout { grid-template-columns: 1fr; }
      .topbar { align-items: flex-start; }
    }

    @media print {
      body { background: white; color: #111; padding: 0; }
      .topbar, .actions, .inline-actions, .scenario-chips { display: none !important; }
      .page { max-width: none; padding: 0; }
      .card { box-shadow: none; border: 1px solid #ddd; background: #fff; }
      button { display: none; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="topbar">
      <div class="brand">
        <span class="eyebrow">Automatizaciones</span>
        <h1>Calculadora de pricing</h1>
        <div style="color: var(--muted); font-size: 14px;">Basada en ahorro, captura de valor y riesgo con escenarios rápidos.</div>
      </div>
      <div class="actions">
        <button class="secondary" id="copy-summary">Copiar resumen</button>
        <button id="print-page">Imprimir / PDF</button>
      </div>
    </header>

    <div class="layout">
      <section class="card">
        <h3>Inputs clave</h3>
        <div class="grid two">
          <label>Horas ahorradas por semana
            <input type="number" id="hoursWeek" min="0" step="0.1" value="8" />
          </label>
          <label>Coste por hora del cliente
            <input type="number" id="clientRate" min="0" step="1" value="45" />
          </label>
          <label>Beneficio incremental mensual
            <input type="number" id="incremental" min="0" step="10" value="300" />
          </label>
          <label>Coste mensual de herramientas
            <input type="number" id="tools" min="0" step="10" value="60" />
          </label>
          <label>Horas de implementación (setup)
            <input type="number" id="setupHours" min="0" step="1" value="18" />
          </label>
          <label>Horas de mantenimiento / mes
            <input type="number" id="maintenanceHours" min="0" step="0.5" value="4" />
          </label>
          <label>Tu tarifa por hora
            <input type="number" id="myRate" min="0" step="1" value="75" />
          </label>
          <label>Margen deseado (%)
            <input type="number" id="margin" min="0" step="1" value="40" />
          </label>
          <label>% de valor capturado
            <input type="number" id="capture" min="0" step="1" value="18" />
          </label>
          <label>Factor de riesgo / complejidad
            <input type="number" id="risk" min="0.5" step="0.05" value="1.0" />
          </label>
          <label>Payback objetivo (meses)
            <input type="number" id="paybackTarget" min="1" step="0.5" value="4" />
          </label>
        </div>

        <div class="card" style="margin-top: 16px;">
          <h3>Notas de alcance</h3>
          <textarea id="notes" placeholder="Notas clave para la propuesta">Automatización n8n: onboarding + follow-up, integraciones básicas con CRM y email. Monitor + alertas semanales.</textarea>
        </div>
      </section>

      <section class="card">
        <div class="scenario-chips">
          <div class="chip active" data-scenario="base">Base</div>
          <div class="chip" data-scenario="conservative">Conservador</div>
          <div class="chip" data-scenario="aggressive">Agresivo</div>
        </div>

        <div class="results-hero">
          <div class="metric-card">
            <div class="metric-label">Setup recomendado</div>
            <div class="metric-value" id="setupOut">—</div>
            <div class="metric-sub" id="setupBase">Coste base: —</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Mensual recomendado</div>
            <div class="metric-value" id="monthlyOut">—</div>
            <div class="metric-sub" id="monthlyDetail">Coste vs valor: —</div>
          </div>
        </div>

        <div class="mini-metrics">
          <div class="metric-card">
            <div class="metric-label">Payback estimado</div>
            <div class="metric-value" id="paybackOut">—</div>
            <div class="metric-sub" id="paybackGap">Objetivo: —</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">ROI a 12 meses</div>
            <div class="metric-value" id="roiOut">—</div>
            <div class="metric-sub" id="roiDetail">—</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Valor mensual generado</div>
            <div class="metric-value" id="valueOut">—</div>
            <div class="metric-sub" id="savingsOut">Ahorro + beneficio</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Coste mensual + setup</div>
            <div class="metric-value" id="costsOut">—</div>
            <div class="metric-sub" id="costsDetail">Mantenimiento + herramientas</div>
          </div>
        </div>

        <div class="scenario-cards" id="scenarioCards"></div>

        <div class="summary-box" id="summaryBox"></div>
        <div class="inline-actions">
          <span class="tag" id="healthTag"></span>
        </div>
      </section>
    </div>
  </div>

  <script>
    const inputs = {
      hoursWeek: document.getElementById('hoursWeek'),
      clientRate: document.getElementById('clientRate'),
      incremental: document.getElementById('incremental'),
      tools: document.getElementById('tools'),
      setupHours: document.getElementById('setupHours'),
      maintenanceHours: document.getElementById('maintenanceHours'),
      myRate: document.getElementById('myRate'),
      margin: document.getElementById('margin'),
      capture: document.getElementById('capture'),
      risk: document.getElementById('risk'),
      paybackTarget: document.getElementById('paybackTarget'),
      notes: document.getElementById('notes')
    };

    const scenarioButtons = Array.from(document.querySelectorAll('.chip[data-scenario]'));
    const scenarioDefs = {
      base: { label: 'Base', multipliers: { margin: 1, capture: 1, risk: 1 } },
      conservative: { label: 'Conservador', multipliers: { margin: 0.65, capture: 0.6, risk: 0.95 } },
      aggressive: { label: 'Agresivo', multipliers: { margin: 1.25, capture: 1.35, risk: 1.2 } }
    };

    const fmtCurrency = new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
    const fmtPercent = new Intl.NumberFormat('es-ES', { style: 'percent', minimumFractionDigits: 0, maximumFractionDigits: 1 });
    const fmtNum = new Intl.NumberFormat('es-ES', { maximumFractionDigits: 1 });

    let currentScenario = 'base';

    function val(inputEl) {
      const n = Number(inputEl.value);
      return Number.isFinite(n) ? n : 0;
    }

    function calculate(base, multipliers) {
      const margin = (base.margin / 100) * multipliers.margin;
      const capture = (base.capture / 100) * multipliers.capture;
      const risk = base.risk * multipliers.risk;

      const hoursMonth = base.hoursWeek * 4.33;
      const savings = hoursMonth * base.clientRate;
      const valueMonthly = savings + base.incremental;
      const costMonthly = base.maintenanceHours * base.myRate + base.tools;
      const costSetup = base.setupHours * base.myRate;

      const setupRecommended = costSetup * (1 + margin) * risk;
      const monthlyCostBased = costMonthly * (1 + margin) * risk;
      const monthlyValueBased = valueMonthly * capture;
      const monthlyRecommended = Math.max(monthlyCostBased, monthlyValueBased);

      const denom = valueMonthly - monthlyRecommended;
      const paybackMonths = denom > 0 ? setupRecommended / denom : null;

      const totalCostYear = setupRecommended + (monthlyRecommended * 12);
      const roi12 = totalCostYear > 0 ? (valueMonthly * 12 - totalCostYear) / totalCostYear : null;

      return {
        setupRecommended,
        monthlyRecommended,
        paybackMonths,
        roi12,
        hoursMonth,
        savings,
        valueMonthly,
        costMonthly,
        costSetup,
        margin,
        capture,
        risk
      };
    }

    function updateUI() {
      const baseInputs = {
        hoursWeek: val(inputs.hoursWeek),
        clientRate: val(inputs.clientRate),
        incremental: val(inputs.incremental),
        tools: val(inputs.tools),
        setupHours: val(inputs.setupHours),
        maintenanceHours: val(inputs.maintenanceHours),
        myRate: val(inputs.myRate),
        margin: val(inputs.margin),
        capture: val(inputs.capture),
        risk: val(inputs.risk),
        paybackTarget: val(inputs.paybackTarget)
      };

      const selectedScenario = scenarioDefs[currentScenario];
      const result = calculate(baseInputs, selectedScenario.multipliers);

      document.getElementById('setupOut').textContent = fmtCurrency.format(result.setupRecommended);
      document.getElementById('monthlyOut').textContent = fmtCurrency.format(result.monthlyRecommended);
      document.getElementById('setupBase').textContent = `Coste base: ${fmtCurrency.format(result.costSetup)}`;
      document.getElementById('monthlyDetail').textContent = `Coste puro: ${fmtCurrency.format(result.costMonthly)} · Valor capturado: ${fmtCurrency.format(result.valueMonthly * result.capture)}`;
      document.getElementById('valueOut').textContent = fmtCurrency.format(result.valueMonthly);
      document.getElementById('savingsOut').textContent = `${fmtCurrency.format(result.savings)} ahorro + ${fmtCurrency.format(baseInputs.incremental)} extra`;
      document.getElementById('costsOut').textContent = fmtCurrency.format(result.costMonthly + result.costSetup / 12);
      document.getElementById('costsDetail').textContent = `Mantenimiento: ${fmtCurrency.format(result.costMonthly - baseInputs.tools)} · Herramientas: ${fmtCurrency.format(baseInputs.tools)}`;

      const payback = result.paybackMonths;
      const paybackTarget = baseInputs.paybackTarget;
      const paybackText = payback ? `${fmtNum.format(payback)} meses` : 'N/A';
      document.getElementById('paybackOut').textContent = paybackText;
      document.getElementById('paybackGap').textContent = payback ? `Objetivo: ${paybackTarget} meses` : 'Objetivo: no alcanzable con estos datos';

      const roiText = result.roi12 != null ? fmtPercent.format(result.roi12) : 'N/A';
      document.getElementById('roiOut').textContent = roiText;
      document.getElementById('roiDetail').textContent = `Costo total año: ${fmtCurrency.format(result.setupRecommended + result.monthlyRecommended * 12)}`;

      renderScenarios(baseInputs);
      renderSummary(selectedScenario.label, result, baseInputs);
      renderHealth(result, paybackTarget);
    }

    function renderScenarios(baseInputs) {
      const container = document.getElementById('scenarioCards');
      container.innerHTML = '';
      Object.entries(scenarioDefs).forEach(([key, def]) => {
        const res = calculate(baseInputs, def.multipliers);
        const card = document.createElement('div');
        card.className = 'scenario-card';
        card.innerHTML = `
          <h4>${def.label} ${key === currentScenario ? '<span class="pill">Seleccionado</span>' : ''}</h4>
          <div class="metric-sub">Margen ${(baseInputs.margin * def.multipliers.margin).toFixed(1)}% · Captura ${(baseInputs.capture * def.multipliers.capture).toFixed(1)}% · Riesgo ${res.risk.toFixed(2)}x</div>
          <div class="metric-value" style="font-size:22px;">${fmtCurrency.format(res.setupRecommended)}</div>
          <div class="metric-sub">Setup recomendado</div>
          <div class="metric-value" style="font-size:20px;">${fmtCurrency.format(res.monthlyRecommended)}</div>
          <div class="metric-sub">Mensual recomendado</div>
          <div class="metric-sub" style="margin-top:6px;">ROI 12m: ${res.roi12 != null ? fmtPercent.format(res.roi12) : 'N/A'}</div>
        `;
        container.appendChild(card);
      });
    }

    function renderSummary(label, res, baseInputs) {
      const payback = res.paybackMonths ? `${fmtNum.format(res.paybackMonths)} meses` : 'No alcanzable con los supuestos actuales';
      const roi = res.roi12 != null ? fmtPercent.format(res.roi12) : 'N/A';
      const summary = [
        `Escenario: ${label}`,
        `Setup recomendado: ${fmtCurrency.format(res.setupRecommended)}`,
        `Mensual recomendado: ${fmtCurrency.format(res.monthlyRecommended)}`,
        `Payback estimado: ${payback} (objetivo ${baseInputs.paybackTarget} meses)`,
        `ROI 12m: ${roi}`,
        `Valor mensual generado: ${fmtCurrency.format(res.valueMonthly)} (ahorro ${fmtCurrency.format(res.savings)} + extra ${fmtCurrency.format(baseInputs.incremental)})`,
        `Coste mensual (mantenimiento + herramientas): ${fmtCurrency.format(res.costMonthly)}`,
        '',
        `Notas: ${inputs.notes.value.trim() || '—'}`
      ].join('\n');
      document.getElementById('summaryBox').textContent = summary;
    }

    function renderHealth(res, target) {
      const tag = document.getElementById('healthTag');
      const gap = res.paybackMonths && target ? res.paybackMonths - target : null;
      if (!res.paybackMonths) {
        tag.textContent = 'Payback no alcanzable con el valor actual';
        tag.className = 'tag danger';
        return;
      }
      if (gap <= 0) {
        tag.textContent = `Payback en ${fmtNum.format(res.paybackMonths)} meses (<= objetivo)`;
        tag.className = 'tag';
      } else {
        tag.textContent = `Payback ${fmtNum.format(gap)} meses por encima del objetivo`;
        tag.className = 'tag danger';
      }
    }

    scenarioButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        currentScenario = btn.dataset.scenario;
        scenarioButtons.forEach(b => b.classList.toggle('active', b === btn));
        updateUI();
      });
    });

    Object.values(inputs).forEach(el => el.addEventListener('input', updateUI));

    document.getElementById('print-page').addEventListener('click', () => window.print());

    document.getElementById('copy-summary').addEventListener('click', async () => {
      const text = document.getElementById('summaryBox').textContent;
      try {
        await navigator.clipboard.writeText(text);
        const btn = document.getElementById('copy-summary');
        const prev = btn.textContent;
        btn.textContent = 'Copiado';
        setTimeout(() => { btn.textContent = prev; }, 1200);
      } catch (_) {
        alert('No se pudo copiar. Revisa permisos del navegador.');
      }
    });

    updateUI();
  </script>
</body>
</html>
